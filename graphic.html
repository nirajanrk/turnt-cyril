<html>
<head>
<!--LEGEND https://developers.google.com/fusiontables/docs/samples/dynamic_styling_template
HEXAGON http://stackoverflow.com/questions/3637613/hexagonal-shaped-cells-in-html -->
<style>
    #map-canvas {height: 400px; width: 450px;}

    #legend {
        background: #FFF ;
        padding: 10px;
        margin: 5px;
        font-size: 12px;
        font-family: Arial, sans-serif;
    }

    #legend p { font-weight: bold; }

    #legend div { padding-bottom: 5px; }

    .color {
        border: 1px solid;
        height: 12px;
        width: 12px;
        margin-right: 3px;
        float: left;
    }

    #boxes {
        padding: 5px;
        margin: 5px;
        font-size: 12px;
        font-family: Arial, sans-serif;
        top: 10px;
    }
</style>
<script>
var map;
//var shoot_table = '1sXHwlcFlYR7PdAJAsPieoqL8X4zXDuYnrgVgYs0';
var shoot_table = '1wkd-SVDOYTcHPoO42m4xd5m6PqUSLn4q_muTD1M';
var murder_table = '1jYDdtK84QVaPJ-HEdmTFLaLQGbWczXdtvRFMbQ0';
var legendTitle = 'Shootings';

var styles = {
'pntcnt': [{
  'min': 0,
  'max': 4,
  'color': '#cfe2f3'
},
{
  'min': 3,
  'max': 14,
  'color': '#9fc5e8'
},
{
  'min': 13,
  'max': 28,
  'color': '#6fa8dc'
},
{
  'min': 27,
  'max': 48,
  'color': '#3d85c6'
},
 {
  'min': 46,
  'max': 68,
  'color': '#0b5394'
}]};

function initialize() {
    map = new google.maps.Map(document.getElementById('map-canvas'), {
        center: new google.maps.LatLng(38.553166,-121.375065),
        zoom: 10,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        draggable: true,
        mapTypeControl: false,
        navigationControl: true,
        panControl: false,
        scrollwheel: false,
        streetViewControl: false,
        scaleControl: true,
        zoomControl: true,
        zoomControlOptions: {
            style: google.maps.ZoomControlStyle.SMALL
        },
    });
    
    //set initial layer to the gov map
    shooting = new google.maps.FusionTablesLayer({
        query: {
            select: 'geometry',
            from: shoot_table,
            where: "pntcnt > 1"
        }
    });

    murders = new google.maps.FusionTablesLayer({
        query: {
            select: 'longitude',
            from: murder_table
        }
    });

    shooting.setMap(map);
    murders.setMap(map);
    applyStyle(map, shooting, 'pntcnt', styles);

    // Create the legend and display on the map
    var legend = document.createElement('div');
        legend.id = 'legend';
        legendContent(legend, styles, 'pntcnt');
        legend.index = 1;
        map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);
    //create checkboxes for shootings, homicides
    var boxes = document.createElement('div');
    boxes.id = 'boxes';
    var shootingBox = document.createElement('input');
    shootingBox.setAttribute('type', 'checkbox');
    shootingBox.setAttribute('id', 'shootings-check');
    shootingBox.setAttribute('onclick', 'changeLayers()');
    shootingBox.setAttribute('checked', true);
    shootingBox.innerHTML='<div>Shootings</div>';
    boxes.appendChild(shootingBox);
    var homicidesBox = document.createElement('input');
    homicidesBox.setAttribute('type', 'checkbox');
    homicidesBox.setAttribute('id', 'homicides-check');
    homicidesBox.setAttribute('onclick', 'changeLayers()');
    homicidesBox.setAttribute('checked', true);
    homicidesBox.innerHTML='Homicides';
    boxes.appendChild(homicidesBox);
    boxes.index = 1;
    map.controls[google.maps.ControlPosition.TOP_LEFT].push(boxes);
}
//end write map

// Apply style to layer
function applyStyle(map, layer, column, style) {
    var bucket = style[column];
    var styles = [];

    for (var i in bucket) {
        var style = bucket[i];
        styles.push({
            where: generateWhere(column, style.min, style.max),
            polygonOptions: {
                fillColor: style.color,
                fillOpacity: style.opacity ? style.opacity : 0.8
            }
        });
    }
    layer.set('styles', styles);
    murders.setMap(map);
}

// Create the where clause
function generateWhere(columnName, low, high) {
    var whereClause = [];
    whereClause.push("'");
    whereClause.push(columnName);
    whereClause.push("' >= ");
    whereClause.push(low);
    whereClause.push(" AND '");
    whereClause.push(columnName);
    whereClause.push("' < ");
    whereClause.push(high);
    return whereClause.join('');
}

// Generate the content for the legend
function legendContent(legend, style, column) {
    var title = document.createElement('p');
    title.innerHTML = legendTitle;
    legend.appendChild(title);

    for (var i in style[column]) {
        var bucket = style[column][i];

        var legendItem = document.createElement('div');

        var color = document.createElement('span');
        color.setAttribute('class', 'color');
        color.style.backgroundColor = bucket.color;
        legendItem.appendChild(color);

        var minMax = document.createElement('span');
        minMax.innerHTML = bucket.min + ' to ' + bucket.max;
        legendItem.appendChild(minMax);

        legend.appendChild(legendItem);
    }
}
//begin change year
function changeYear(searchString) {
var searchString = searchString;

    if (searchString) {
        murders.setOptions({
            query: {
                select: 'longitude', 
                from: murder_table,
                where: "Year = " + searchString
            }
        });
    } else {
        
        murders.setOptions({
            query: {
                select: 'longitude',
                from: murder_table
            }
        });
    }
}

function changeLayers() {
    //both checked
    if (document.getElementById('shootings-check').checked & document.getElementById('homicides-check').checked)
    {
        shooting.setMap(map);
        murders.setMap(map);
        console.log('both');
    }
    else if (document.getElementById('shootings-check').checked == false & document.getElementById('homicides-check').checked) {
        shooting.setMap();
        murders.setMap(map);
        console.log('just murders');
    }
    else if (document.getElementById('homicides-check').checked == false & document.getElementById('shootings-check').checked) {
        murders.setMap();
        shooting.setMap(map);
        console.log('just shootings');
    }
    else {
        murders.setMap();
        shooting.setMap();
        console.log('none');
    }
}

</script>



<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

</head>

<body onload="initialize()">
<!-- <div style="margin-bottom: 10px;">
    <select id="search-string" onchange="changeMap();">
    <option value="">All</option>
    <option value="2007">2007</option>
    <option value="2008">2008</option>
    <option value="2009">2009</option>
    <option value="2010">2010</option>
    <option value="2011">2011</option>
    <option value="2012">2012</option>
  </select>
</div>-->

<div id="map-canvas"></div>
    <input type="radio" name="year-button" onclick="changeYear();" value="" checked>2007-2012</input>
    <input type="radio" name="year-button" onclick="changeYear(this.value);" value="2007">2007</input>
    <input type="radio" name="year-button" onclick="changeYear(this.value);" value="2008">2008</input>
    <input type="radio" name="year-button" onclick="changeYear(this.value);" value="2009">2009</input>
    <input type="radio" name="year-button" onclick="changeYear(this.value);" value="2010">2010</input>
    <input type="radio" name="year-button" onclick="changeYear(this.value);" value="2011">2011</input>
    <input type="radio" name="year-button" onclick="changeYear(this.value);" value="2012">2012</input>
<!--    <hr>
    <input type="checkbox" id='shootings-check' onclick="changeLayers()" value="shootings" checked>Shootings</input>
    <input type="checkbox" id='homicides-check' onclick="changeLayers()" value="homicides" checked>Homicides</input> -->

</body>
</html>