<html>
<head>
<!--LEGEND https://developers.google.com/fusiontables/docs/samples/dynamic_styling_template -->
<style>
    #map-canvas {height: 400px; width: 300px;}

    #legend {
        background: #FFF;
        padding: 10px;
        margin: 5px;
        font-size: 12px;
        font-family: Arial, sans-serif;
    }

    #legend p { font-weight: bold; }

    #legend div { padding-bottom: 5px; }

    .color {
        border: 1px solid;
        height: 12px;
        width: 12px;
        margin-right: 3px;
        float: left;
    }
</style>
<script>
var map;
var shoot_table = '1sXHwlcFlYR7PdAJAsPieoqL8X4zXDuYnrgVgYs0';
var murder_table = '1jYDdtK84QVaPJ-HEdmTFLaLQGbWczXdtvRFMbQ0';
var legendTitle = 'Shootings';

var styles = {
'Shootings': [{
  'min': 0,
  'max': 3,
  'color': '#cfe2f3'
},
{
  'min': 3,
  'max': 13,
  'color': '#9fc5e8'
},
{
  'min': 13,
  'max': 27,
  'color': '#6fa8dc'
},
{
  'min': 27,
  'max': 46,
  'color': '#3d85c6'
},
 {
  'min': 46,
  'max': 67,
  'color': '#0b5394'
}]};

function initialize() {
    map = new google.maps.Map(document.getElementById('map-canvas'), {
        center: new google.maps.LatLng(38.553166,-121.375065),
        zoom: 10,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        draggable: true,
        mapTypeControl: false,
        navigationControl: true,
        panControl: false,
        scrollwheel: false,
        streetViewControl: false,
        scaleControl: true,
        zoomControl: true,
        zoomControlOptions: {
            style: google.maps.ZoomControlStyle.SMALL
        },
    });
    
    //set initial layer to the gov map
    shooting = new google.maps.FusionTablesLayer({
        query: {
            select: 'geometry',
            from: shoot_table,
            where: "PNTCNT > 1"
        }
    });

    murders = new google.maps.FusionTablesLayer({
        query: {
            select: 'longitude',
            from: murder_table,
            where: "Year = 2008",
            or: "Year = 2009"
        }
    });

    shooting.setMap(map);
    murders.setMap(map);

    for (column in styles) { break; }

    applyStyle(map, shooting, column);

    // Create the legend and display on the map
    var legend = document.createElement('div');
        legend.id = 'legend';
        legendContent(legend);
        legend.index = 1;
        map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);
}
//end write map

// Apply style to layer
function applyStyle(map, layer, column) {
    var bucket = styles[column];
    var styles = [];

    for (var i in bucket) {
        var style = bucket[i];
        styles.push({
            where: generateWhere(column, style.min, style.max),
            polygonOptions: {
                fillColor: style.color,
                fillOpacity: style.opacity ? style.opacity : 0.8
            }
        });
    }
    layer.set('styles', styles);
}

// Create the where clause
function generateWhere(columnName, low, high) {
    var whereClause = [];
    whereClause.push("'");
    whereClause.push(columnName);
    whereClause.push("' >= ");
    whereClause.push(low);
    whereClause.push(" AND '");
    whereClause.push(columnName);
    whereClause.push("' < ");
    whereClause.push(high);
    return whereClause.join('');
}

// Generate the content for the legend
function legendContent(legend) {
    var title = document.createElement('p');
    title.innerHTML = legendTitle;
    legend.appendChild(title);

    for (var i in styles) {
        var bucket = styles[i];

        var legendItem = document.createElement('div');

        var color = document.createElement('span');
        color.setAttribute('class', 'color');
        color.style.backgroundColor = bucket.color;
        legendItem.appendChild(color);

        var minMax = document.createElement('span');
        minMax.innerHTML = bucket.min + ' to ' + bucket.max;
        legendItem.appendChild(minMax);

        legend.appendChild(legendItem);
    }
}

//begin change layer
function changeMap(searchString) {
var searchString = searchString;

    if (searchString) {
        murders.setOptions({
            query: {
                select: 'longitude', 
                from: murder_table,
                where: "Year = " + searchString
            }
        });
    } else {
        
        murders.setOptions({
            query: {
                select: 'longitude',
                from: murder_table
            }
        });
    }
}

</script>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

</head>

<body onload="initialize()">
<!-- <div style="margin-bottom: 10px;">
    <select id="search-string" onchange="changeMap();">
    <option value="">All</option>
    <option value="2007">2007</option>
    <option value="2008">2008</option>
    <option value="2009">2009</option>
    <option value="2010">2010</option>
    <option value="2011">2011</option>
    <option value="2012">2012</option>
  </select>
</div>-->

<for name="years">
    <input type="checkbox" name= 'year-check' onclick="changeMap();" value="">2007-2012</input>
    <input type="checkbox" name= 'year-check' onclick="changeMap(this.value);" value="2007">2007</input>
    <input type="checkbox" name= 'year-check' onclick="changeMap(this.value);" value="2008">2008</input>
    <input type="checkbox" name= 'year-check' onclick="changeMap(this.value);" value="2009">2009</input>
<div id="map-canvas"></div>
</body>
</html>